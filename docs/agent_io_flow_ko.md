# LLM 에이전트 프롬프트 전문 (한국어 버전)

이 문서는 전염병 모델(ode_031)의 실제 로그를 바탕으로 LLM 에이전트에게 전달되고 응답받는 프롬프트의 전문을 한국어로 보여줍니다.

**실제 로그 파일**: `ode_031_35.json` (Iteration 35/300)

---

## 1. Sampler Agent - 입력 프롬프트
Scientist의 피드백과 제거 목록이 포함된 실제 프롬프트입니다.

**조건**: SIR 전염병 모델 (ode_031), Iteration 35/300

```text
당신은 미분방정식(ODE) 발견을 전문으로 하는 수학자입니다.

# 시스템 설명
이 전염병학 모델은 질병 상태에 따라 인구를 구획으로 나누어 집단 내 질병 전파 역학을 추적합니다. 
상태 변수 x0는 아직 감염되지 않았고 면역이 없는 감수성 개체의 비율 또는 수를 나타냅니다. 
x1은 현재 감염되어 있으며 감수성 개체와 접촉 시 질병을 전파할 수 있는 감염 개체의 비율 또는 수를 
나타냅니다. 질병 전파의 물리적 메커니즘은 질량 작용 역학(mass-action dynamics)을 따릅니다. 
감염은 감수성 개체와 감염 개체가 접촉할 때 발생하며, 전파 확률은 그들의 밀도의 곱에 의존하여 
실제 접촉 빈도를 반영합니다. 실험자는 감염 개체가 존재할 때, 감수성 개체가 많을수록 감염 개체가 
그들에게 질병을 전파하는 속도가 비례하여 빠르다는 것을 관찰합니다. 동시에, 감염 개체는 면역 획득, 
격리 또는 사망과 같은 다양한 전염병학적 요인으로 인해 일정한 비율로 회복되거나 감염 집단에서 
제거됩니다. 실험 시나리오에서는 초기에 소수의 감염 개체가 대규모 감수성 집단에 도입됩니다. 
전파율이 회복률을 초과하면, 즉 기본 재생산 수 R₀가 임계값을 초과하면 전염병이 발생합니다. 
감염 개체의 수는 기하급수적으로 빠르게 증가하여 감수성 개체가 고갈됨에 따라 정점에 도달한 다음 
회복 개체가 축적됨에 따라 감소합니다. 이 역학은 임계 현상을 드러냅니다. 감수성 개체의 비율이 
특정 임계값 미만이면 감염이 소멸하고, 그 이상이면 전염병이 확산됩니다. 이 모델은 백신 접종 및 
격리와 같은 질병 통제 전략을 이해하기 위한 근본적인 통찰력을 제공합니다.

### SCIENTIST AGENT GUIDANCE
Scientist 에이전트가 이전 실험들을 분석하고 다음 지침을 제공했습니다:

#### 축적된 지식 (이론)
- 질량 작용 전파 항(x0_t의 -0.4000*x0*x1)과 그 대응항(x1_t의 0.4000*x0*x1), 그리고 회복 항
  (x1_t의 -0.3140*x1)은 시스템 설명에 의해 잘 뒷받침되며 'good'으로 평가됩니다. 
- 상수 항들(x0_t의 0.0001과 x1_t의 -0.0002)은 여전히 뒷받침되지 않으며 'bad'로 평가되며, 
  이전 평가와 일치합니다. 이러한 상수 항들은 설명된 물리적 메커니즘과 일치하지 않으므로 
  제거되어야 합니다.

#### 항별 상세 평가 (이전 시도 분석)
각 항에 대한 평가 결과입니다. keep은 유지, hold는 보류/수정, remove는 제거하세요:
x0_t:
  - 1.0000*(-0.4000*x0*x1) : KEEP
x1_t:
  - 1.0001*(0.4000*x0*x1) : KEEP
  - 0.9999*(-0.3140*x1) : KEEP

#### 제거된 항 목록 (금지 목록)
다음 구조의 항들은 성능에 부정적인 영향을 주었으므로 **다시 제안하지 마세요**:
  x0_t: C * 1
  x1_t: C * 1, C*(C*x1*x1), C*x0

**목표:** Scientist의 인사이트와 지침을 수식 구조에 반영하세요.

[필수 조건 (위반 시 오류 발생)]
1. 사용 가능: import numpy as np
2. 함수 시그니처: def [function_name](x0, x1, params): return ...
   - 이 시스템은 2차원입니다
   - (허용) 사용 가능한 변수: x0, x1 (총 2개)
   - (금지) 변수 x2 이상은 허용되지 않습니다 (존재하지 않습니다!)
3. params 사용: 각 함수(x0_t, x1_t)는 자체 독립적인 params 배열을 가집니다. params[0]부터 시작하세요.
4. params 제한: 각 항은 최대 8개의 params를 사용할 수 있습니다.
   - 예시: params[0]*x0 (1개 사용), params[0]*sin(params[1]*x0) (2개 사용)
5. 의미 있는 상수: 물리적으로 의미 있는 상수에는 params를 사용하지 마세요.
   - 예시: params[0]*x/(x+1)이 params[0]*x/(x+params[1])보다 선호됩니다
   - 명확한 물리적 의미를 가진 상수에는 직접 숫자를 사용하세요 (예: 2*np.pi*x0)
6. 중복 금지: 이전 시도와 동일한 방정식은 금지됩니다. 구조적 수정이 필요합니다.
7. 근거 필수: 각 항을 제안할 때 시스템 설명(desc)을 기반으로 물리적/수학적 근거를 제공하세요.

[예시 (2D 시스템)]
x0_t: ["params[0]*x0", "params[1]*x1"]
x1_t: ["params[0]*x0", "params[1]*np.sin(params[2]*x1)"]
```

---

## 2. Sampler Agent - 출력
위 프롬프트에 대한 Sampler의 실제 응답입니다.

```json
{
  "ode_pairs": [
    {
      "x0_t": [
        {
          "term": "-0.4000*x0*x1",
          "reasoning": "이 항은 질량 작용 전파 역학을 나타내며, 새로운 감염률이 감수성(x0)과 감염(x1) 개체의 곱에 비례합니다. 음수 부호는 감염으로 인한 감수성 집단의 감소를 나타냅니다."
        }
      ],
      "x1_t": [
        {
          "term": "0.4000*x0*x1",
          "reasoning": "이 항은 새로운 감염으로 인한 감염 집단의 증가를 모델링하며, 질량 작용 동역학을 통한 감수성 개체의 손실에 직접 대응합니다."
        },
        {
          "term": "-0.3140*x1",
          "reasoning": "이 항은 감염 개체의 회복 또는 제거를 나타냅니다. 비율은 감염 개체의 수에 비례하며, 감염 개체가 일정한 비율로 감염 구획을 떠나는 것을 반영합니다."
        }
      ],
      "pair_reasoning": "이 쌍은 설명된 핵심 SIR 유사 역학을 직접 구현합니다: 감수성에서 감염으로의 질량 작용 전파, 그리고 감염 구획으로부터의 일정한 회복/제거율. 이는 이러한 항들에 대한 scientist의 'good' 평가를 준수하고 뒷받침되지 않는 상수 항을 무시합니다."
    }
  ]
}
```

---

## 3. Scientist Agent - 입력 프롬프트
실험 결과(MSE)와 이전 시도 비교가 포함된 Scientist 평가 프롬프트입니다.

```text
당신은 ODE(미분방정식) 발견을 전문으로 하는 수석 과학자입니다.
실험 결과를 분석하고 **항별 평가**를 수행하세요.

**진행 상황**: 전체 300번 시행 중 현재 35번째 시행

시스템 설명: 이 전염병학 모델은 질병 상태에 따라 인구를 구획으로 나누어 집단 내 질병 전파 
역학을 추적합니다... (생략)

=== 축적된 인사이트 ===
질량 작용 전파 항(x0_t의 -0.4000*x0*x1)과 그 대응항(x1_t의 0.4000*x0*x1), 그리고 회복 항
(x1_t의 -0.3140*x1)은 시스템 설명에 의해 잘 뒷받침되며 'good'으로 평가됩니다. 상수 항들
(x0_t의 0.0001과 x1_t의 -0.0002)은 여전히 뒷받침되지 않으며 'bad'로 평가되며, 이전 평가와 
일치합니다. 이러한 상수 항들은 설명된 물리적 메커니즘과 일치하지 않으므로 제거되어야 합니다.

=== 제거된 항 목록 (이전 반복에서 'remove'로 표시됨) ===
*아래와 동일한 스켈레톤 구조를 가진 항을 제안하지 마세요.*
  x0_t: C * 1
  x1_t: C * 1, C*(C*x1*x1), C*x0

=== 새 실험 결과 ===

=== 이전 실험 결과 ===
[Global Best (목표)] (x0_t: 9.471707e-09, x1_t: 9.765022e-09)
x0_t = (1.0000*(-0.4000*x0*x1)) + 0.0001
x1_t = (1.0001*(0.4000*x0*x1)) + (0.9999*(-0.3140*x1)) - 0.0002

[이전 시도] (x0_t: 9.471707e-09, x1_t: 9.765022e-09)
x0_t = (1.0000*(-0.4000*x0*x1)) + 0.0001
x1_t = (1.0001*(0.4000*x0*x1)) + (0.9999*(-0.3140*x1)) - 0.0002

=== 새 실험 결과 ===
[현재 시도] (x0_t: 9.471707e-09, x1_t: 9.765022e-09)
x0_t = 1.0000*(-0.4000*x0*x1) + 0.0001 * 1
  [Sampler의 근거]
  - 1.0000*(-0.4000*x0*x1): 이 항은 질량 작용 전파 역학을 나타내며, 새로운 감염률이 감수성(x0)과 
    감염(x1) 개체의 곱에 비례합니다. 음수 부호는 감염으로 인한 감수성 집단의 감소를 나타냅니다.

x1_t = 1.0001*(0.4000*x0*x1) + 0.9999*(-0.3140*x1) - 0.0002 * 1
  [Sampler의 근거]
  - 1.0001*(0.4000*x0*x1): 이 항은 새로운 감염으로 인한 감염 집단의 증가를 모델링하며, 질량 작용 
    동역학을 통한 감수성 개체의 손실에 직접 대응합니다.
  - 0.9999*(-0.3140*x1): 이 항은 감염 개체의 회복 또는 제거를 나타냅니다. 비율은 감염 개체의 수에 
    비례하며, 감염 개체가 일정한 비율로 감염 구획을 떠나는 것을 반영합니다.

[항별 평가 수행 방법]

현재 시도의 모든 항에 대해 다음 2가지 측면만 평가하세요:

1. 의미론적 품질 (semantic_quality)
시스템 설명(desc)을 기반으로 평가:
- good: 시스템의 물리적/수학적 의미와 명확히 일치 (**주의: 함수당 최대 3개**)
- neutral: 어느 정도 관련성이 있지만 필수적이지 않음
- bad: 시스템과 무관하거나 모순됨

2. 근거 (reasoning)
1-2문장으로 평가를 설명하세요. 시스템 설명(물리적 의미)에 초점을 맞추세요.

[중요 참고사항]
- 계수 분석 사용: 계수가 0에 가까운 항은 제거 후보입니다. 모든 계수가 0에서 멀다면 최적화가 
  불충분할 수 있습니다.
```

---

## 4. Scientist Agent - 출력
LLM이 생성한 실제 평가 결과입니다.

```json
{
  "term_evaluations": {
    "x0_t": [
      {
        "term": "1.0000*(-0.4000*x0*x1)",
        "semantic_quality": "good",
        "reasoning": "이 항은 질병의 질량 작용 전파를 정확히 반영하며, 감수성 개체의 감소율이 감수성 집단과 감염 집단의 곱에 비례합니다.",
        "performance_impact": "positive",
        "action": "keep"
      },
      {
        "term": "0.0001 * 1",
        "semantic_quality": "bad",
        "reasoning": "상수 항은 질병 전파 또는 회복의 설명된 물리적 메커니즘과 일치하지 않습니다. 이는 집단 상호작용과 비율에 의해 구동되며, 임의의 상수 유입이 아닙니다.",
        "performance_impact": "positive",
        "action": "remove"
      }
    ],
    "x1_t": [
      {
        "term": "1.0001*(0.4000*x0*x1)",
        "semantic_quality": "good",
        "reasoning": "이 항은 새로운 감염으로 인한 감염 개체의 증가를 올바르게 모델링하며, 설명된 질량 작용 전파에 직접 대응합니다.",
        "performance_impact": "positive",
        "action": "keep"
      },
      {
        "term": "0.9999*(-0.3140*x1)",
        "semantic_quality": "good",
        "reasoning": "이 항은 일정한 비율로 감염 개체의 제거를 나타내며, 시스템에 설명된 회복 또는 기타 제거 메커니즘과 일치합니다.",
        "performance_impact": "positive",
        "action": "keep"
      },
      {
        "term": "-0.0002 * 1",
        "semantic_quality": "bad",
        "reasoning": "상수 항은 설명된 물리적 메커니즘에 의해 뒷받침되지 않습니다. 질병 역학은 집단 상호작용과 비율에 의해 구동될 것으로 예상되며, 임의의 상수 유입 또는 유출이 아닙니다.",
        "performance_impact": "positive",
        "action": "remove"
      }
    ]
  },
  "updated_insight": "질량 작용 전파 항(x0_t의 -0.4000*x0*x1과 x1_t의 0.4000*x0*x1)과 회복 항(x1_t의 -0.3140*x1)은 시스템 설명에 의해 잘 뒷받침되며 'good'으로 평가됩니다. 상수 항들(x0_t의 0.0001과 x1_t의 -0.0002)은 여전히 뒷받침되지 않으며 'bad'로 평가되며, 이전 평가와 일치합니다. 이러한 상수 항들은 설명된 물리적 메커니즘과 일치하지 않으므로 제거되어야 합니다."
}
```

---

## 5. 후처리: Action 결정 규칙

시스템은 Scientist의 `semantic_quality` 응답과 ablation study 결과(`performance_impact`)를 바탕으로 각 항을 추적/제거합니다.

### 5.1 Action 결정 로직

**입력:**
- `semantic_quality`: good / neutral / bad
- `performance_impact` (ablation study): positive / neutral / negative

**규칙:**

1. **`semantic_quality == "bad"`** → 즉시 `remove`
2. **`semantic_quality == "good"` AND `performance_impact == "positive"`** → `keep`
3. **그 외 모든 경우** → `hold` (상태 추적 시작 또는 유지)

### 5.2 상태 전이 모델

동일한 **스켈레톤(Skeleton, 계수를 C로 치환한 구조)**을 기준으로 상태가 전이됩니다:

- **bad → remove** (즉시 제거)
- **hold1 → hold2 → remove** (2회 연속 hold 시 제거)
- **keep** (유지, 상태 변화 없음)

### 5.3 실제 전이 예시 (ode_031 기반)

| 항 (Skeleton) | 이전 상태 | Scientist 평가 | Impact | 최종 Action | 상태 전이 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `C*(-C*x0*x1)` (x0_t) | hold1 | good | positive | **keep** | hold1 → keep |
| `C * 1` (x0_t) | hold1 | bad | positive | **remove** | hold1 → remove (즉시) |
| `C*(C*x0*x1)` (x1_t) | hold1 | good | positive | **keep** | hold1 → keep |
| `C*(-C*x1)` (x1_t) | hold1 | good | positive | **keep** | hold1 → keep |
| `C * 1` (x1_t) | hold1 | bad | positive | **remove** | hold1 → remove (즉시) |

### 5.4 금지 목록 (Removed Terms) 누적

`remove` 판정된 항들의 스켈레톤은 **제거 목록(removed_terms_per_dim)**에 누적되며, 다음 Iteration부터 Sampler에게 **"Removed Terms List (Ban List)"** 섹션으로 전달됩니다.

**실제 예시 (ode_031_35.json):**
```
#### Removed Terms List (Ban List)
The following term structures have negatively impacted performance. **Do NOT propose them again**:
  x0_t: C * 1
  x1_t: C * 1, C*(C*x1*x1), C*x0
```

**주의사항:**
- Scientist에게는 **현재까지 제거된 전체 목록**이 전달됩니다.
- Sampler에게는 **재제안 금지 목록**으로 전달되며, 동일한 스켈레톤 구조를 가진 항은 제안할 수 없습니다.
- 스켈레톤은 모든 계수를 `C`로 치환한 구조적 형태입니다 (예: `1.0000*(-0.4000*x0*x1)` → `C*(-C*x0*x1)`)

---

## 6. 실제 생성된 코드

Sampler가 제안한 항들은 다음과 같이 실행 가능한 Python 코드로 변환됩니다:

```python
def x0_t(x0, x1, params):
    import numpy as np
    return (params[0]*(-0.4000*x0*x1)) + params[1] * 1

def x1_t(x0, x1, params):
    import numpy as np
    return (params[0]*(0.4000*x0*x1)) + (params[1]*(-0.3140*x1)) + params[2] * 1
```

**최적화된 파라미터 (Differential Evolution 결과):**
- `x0_t params`: [1.0000, 0.0001, ...]
- `x1_t params`: [1.0001, 0.9999, -0.0002, ...]

**성능 (MSE):**
- `x0_t`: 9.471707e-09
- `x1_t`: 9.765022e-09
